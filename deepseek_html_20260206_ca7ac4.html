<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–†–æ–º–∞—Ä–∏–æ AI | Liquid Glass Interface</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif;
      background: #000;
      color: #fff;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    /* Liquid Glass Background */
    .liquid-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: 
        radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.1) 0%, transparent 50%);
      filter: blur(60px);
    }
    
    .app-container {
      display: flex;
      min-height: 100vh;
      max-width: 1600px;
      margin: 0 auto;
      padding: 20px;
      gap: 20px;
    }
    
    /* –î–∏–∞–ª–æ–≥–∏ –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
    .dialogs-sidebar {
      width: 320px;
      background: rgba(255, 255, 255, 0.04);
      backdrop-filter: blur(40px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 24px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    
    .dialogs-header {
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      margin-bottom: 20px;
    }
    
    .dialogs-header h2 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .new-dialog-btn {
      width: 100%;
      background: linear-gradient(135deg, 
        rgba(100, 200, 255, 0.9), 
        rgba(200, 100, 255, 0.8));
      border: none;
      border-radius: 16px;
      padding: 14px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 16px;
    }
    
    .new-dialog-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(100, 200, 255, 0.4);
    }
    
    .dialogs-list {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .dialog-item {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }
    
    .dialog-item:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(100, 200, 255, 0.3);
    }
    
    .dialog-item.active {
      background: rgba(100, 200, 255, 0.15);
      border-color: rgba(100, 200, 255, 0.5);
    }
    
    .dialog-title {
      font-weight: 600;
      margin-bottom: 6px;
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .dialog-preview {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 8px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .dialog-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.4);
    }
    
    .dialog-actions {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 8px;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .dialog-item:hover .dialog-actions {
      opacity: 1;
    }
    
    .dialog-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.7);
    }
    
    .dialog-btn.delete:hover {
      background: rgba(255, 100, 100, 0.2);
      color: #ff6464;
    }
    
    /* –û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç */
    .chat-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .chat-header {
      background: rgba(255, 255, 255, 0.04);
      backdrop-filter: blur(40px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 24px;
      padding: 24px;
      box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    
    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .current-dialog-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: #fff;
    }
    
    .current-dialog-subtitle {
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.9rem;
      margin-top: 4px;
    }
    
    .chat-controls {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .control-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .control-group label {
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.6);
    }
    
    select, input[type="range"] {
      background: rgba(255, 255, 255, 0.07);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 8px 12px;
      color: white;
      font-size: 0.9rem;
      min-width: 160px;
    }
    
    select option {
      background: #1a1a1a;
    }
    
    .chat-container {
      flex: 1;
      background: rgba(255, 255, 255, 0.04);
      backdrop-filter: blur(40px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 24px;
      padding: 30px;
      display: flex;
      flex-direction: column;
      box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding-right: 10px;
      margin-bottom: 24px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .chat-messages::-webkit-scrollbar {
      width: 6px;
    }
    
    .chat-messages::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
    }
    
    .chat-messages::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
    }
    
    .message {
      display: flex;
      gap: 12px;
      animation: messageAppear 0.4s ease;
    }
    
    @keyframes messageAppear {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .message.user {
      flex-direction: row-reverse;
    }
    
    .message-bubble {
      max-width: 75%;
      padding: 18px;
      border-radius: 22px;
      position: relative;
      word-wrap: break-word;
      line-height: 1.5;
    }
    
    .message.assistant .message-bubble {
      background: rgba(255, 255, 255, 0.07);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-bottom-left-radius: 8px;
    }
    
    .message.user .message-bubble {
      background: linear-gradient(135deg, 
        rgba(100, 150, 255, 0.3), 
        rgba(200, 100, 255, 0.2));
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      color: white;
      border-bottom-right-radius: 8px;
    }
    
    .message-time {
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.4);
      margin-top: 6px;
      text-align: right;
    }
    
    /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */
    .chat-input-area {
      margin-top: auto;
    }
    
    .system-prompt-area {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 16px;
    }
    
    .system-prompt-area label {
      display: block;
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.9rem;
      margin-bottom: 8px;
    }
    
    .system-prompt-area textarea {
      width: 100%;
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.9rem;
      resize: none;
      min-height: 60px;
      outline: none;
    }
    
    .message-input-area {
      display: flex;
      gap: 12px;
      align-items: flex-end;
    }
    
    .message-input-area textarea {
      flex: 1;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 18px;
      padding: 18px;
      color: white;
      font-size: 1rem;
      resize: none;
      min-height: 60px;
      max-height: 120px;
      outline: none;
      transition: all 0.3s;
    }
    
    .message-input-area textarea:focus {
      border-color: rgba(100, 200, 255, 0.4);
      box-shadow: 0 0 0 2px rgba(100, 200, 255, 0.1);
    }
    
    .send-btn {
      background: linear-gradient(135deg, 
        rgba(100, 200, 255, 0.9), 
        rgba(200, 100, 255, 0.8));
      border: none;
      border-radius: 16px;
      width: 56px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      flex-shrink: 0;
    }
    
    .send-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(100, 200, 255, 0.4);
    }
    
    .send-btn:active {
      transform: translateY(0);
    }
    
    .send-btn svg {
      width: 24px;
      height: 24px;
      stroke: white;
    }
    
    /* –¢–∞–π–ø–ø–∏–Ω–≥ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä */
    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 18px;
      background: rgba(255, 255, 255, 0.07);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 22px;
      width: fit-content;
      border-bottom-left-radius: 8px;
      margin-bottom: 20px;
    }
    
    .typing-dot {
      width: 8px;
      height: 8px;
      background: rgba(255, 255, 255, 0.4);
      border-radius: 50%;
      animation: typing 1.4s infinite;
    }
    
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-8px); }
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 1024px) {
      .app-container {
        flex-direction: column;
      }
      
      .dialogs-sidebar {
        width: 100%;
        max-height: 300px;
      }
      
      .chat-controls {
        flex-wrap: wrap;
      }
    }
    
    @media (max-width: 768px) {
      .app-container {
        padding: 12px;
      }
      
      .chat-header,
      .dialogs-sidebar,
      .chat-container {
        padding: 20px;
      }
      
      .control-group {
        flex: 1;
        min-width: 140px;
      }
    }
  </style>
</head>
<body>
  <div class="liquid-background"></div>
  
  <div class="app-container">
    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –¥–∏–∞–ª–æ–≥–∞–º–∏ -->
    <aside class="dialogs-sidebar">
      <div class="dialogs-header">
        <h2>üìö –î–∏–∞–ª–æ–≥–∏</h2>
        <button class="new-dialog-btn" id="newDialogBtn">
          + –ù–æ–≤—ã–π –¥–∏–∞–ª–æ–≥
        </button>
      </div>
      
      <div class="dialogs-list" id="dialogsList">
        <!-- –î–∏–∞–ª–æ–≥–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
        <div class="empty-state" id="emptyState" style="text-align: center; padding: 40px 20px; color: rgba(255,255,255,0.4)">
          <p>–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤</p>
          <p style="font-size: 0.9rem; margin-top: 10px;">–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ</p>
        </div>
      </div>
    </aside>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç -->
    <main class="chat-main">
      <header class="chat-header">
        <div class="header-top">
          <div>
            <h1 class="current-dialog-title" id="currentDialogTitle">–ù–æ–≤—ã–π –¥–∏–∞–ª–æ–≥</h1>
            <p class="current-dialog-subtitle" id="currentDialogSubtitle">–ù–∞—á–Ω–∏—Ç–µ —Ä–∞–∑–≥–æ–≤–æ—Ä —Å –†–æ–º–∞—Ä–∏–æ</p>
          </div>
          
          <div class="chat-controls">
            <div class="control-group">
              <label for="modelSelect">–ú–æ–¥–µ–ª—å:</label>
              <select id="modelSelect">
                <option value="gpt-4o-mini">GPT-4o Mini</option>
                <option value="gpt-4o" selected>GPT-4o</option>
                <option value="gpt-4-turbo">GPT-4 Turbo</option>
                <option value="claude-3-opus">Claude 3 Opus</option>
              </select>
            </div>
            
            <div class="control-group">
              <label for="tempRange">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: <span id="tempValue">0.7</span></label>
              <input id="tempRange" type="range" min="0" max="1" step="0.1" value="0.7">
            </div>
            
            <button class="new-dialog-btn" id="newDialogBtn2" style="width: auto; padding: 10px 20px;">
              –ù–æ–≤—ã–π –¥–∏–∞–ª–æ–≥
            </button>
          </div>
        </div>
        
        <div class="system-prompt-area">
          <label for="systemPrompt">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞:</label>
          <textarea id="systemPrompt" rows="2">–¢—ã ‚Äî –†–æ–º–∞—Ä–∏–æ, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –û—Ç–≤–µ—á–∞–π —Ç–æ—á–Ω–æ, –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É—è markdown –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –ë—É–¥—å –ø–æ–ª–µ–∑–Ω—ã–º –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º.</textarea>
        </div>
      </header>
      
      <div class="chat-container">
        <div class="chat-messages" id="chatMessages">
          <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
          <div class="message assistant">
            <div class="message-bubble">
              üëã –ü—Ä–∏–≤–µ—Ç! –Ø –†–æ–º–∞—Ä–∏–æ ‚Äî –≤–∞—à –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å, –∏ —è –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –ø–æ–º–æ—á—å. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–æ–≤ –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏.
            </div>
            <div class="message-time" id="currentTime"></div>
          </div>
        </div>
        
        <div class="chat-input-area">
          <div class="message-input-area">
            <textarea 
              id="messageInput" 
              placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." 
              rows="2"
            ></textarea>
            <button class="send-btn" id="sendBtn">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let currentDialogId = null;
    let dialogs = [];
    let isStreaming = false;
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
      updateCurrentTime();
      loadDialogs();
      updateTemperatureDisplay();
      setupEventListeners();
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π –¥–∏–∞–ª–æ–≥ –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π
      const lastActiveId = localStorage.getItem('lastActiveDialog');
      if (lastActiveId && dialogs.find(d => d.id === lastActiveId)) {
        loadDialog(lastActiveId);
      } else if (dialogs.length > 0) {
        loadDialog(dialogs[0].id);
      } else {
        createNewDialog();
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
      setInterval(updateCurrentTime, 60000);
      
      // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
      document.getElementById('messageInput').focus();
    });
    
    // –ù–ê–°–¢–†–û–ô–ö–ê –í–°–ï–• –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í –°–û–ë–´–¢–ò–ô
    function setupEventListeners() {
      // –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
      const sendBtn = document.getElementById('sendBtn');
      sendBtn.addEventListener('click', sendMessage);
      
      // –ü–æ–ª–µ –≤–≤–æ–¥–∞ - –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ Enter (–±–µ–∑ Shift)
      const messageInput = document.getElementById('messageInput');
      messageInput.addEventListener('keydown', function(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
          event.preventDefault();
          sendMessage();
        }
      });
      
      // –ö–Ω–æ–ø–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞
      const newDialogBtn = document.getElementById('newDialogBtn');
      const newDialogBtn2 = document.getElementById('newDialogBtn2');
      if (newDialogBtn) newDialogBtn.addEventListener('click', createNewDialog);
      if (newDialogBtn2) newDialogBtn2.addEventListener('click', createNewDialog);
      
      // –ü–æ–ª–∑—É–Ω–æ–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
      const tempRange = document.getElementById('tempRange');
      tempRange.addEventListener('input', updateTemperatureDisplay);
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
    function updateCurrentTime() {
      const now = new Date();
      const timeString = now.toLocaleTimeString('ru-RU', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });
      document.querySelectorAll('.message-time').forEach(el => {
        if (el.id === 'currentTime') {
          el.textContent = timeString;
        }
      });
    }
    
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
    function updateTemperatureDisplay() {
      const tempValue = document.getElementById('tempRange').value;
      document.getElementById('tempValue').textContent = tempValue;
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤ –∏–∑ localStorage
    function loadDialogs() {
      try {
        const saved = localStorage.getItem('romarioDialogs');
        dialogs = saved ? JSON.parse(saved) : [];
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏–∞–ª–æ–≥–æ–≤:', e);
        dialogs = [];
      }
      renderDialogsList();
    }
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤ –≤ localStorage
    function saveDialogs() {
      try {
        localStorage.setItem('romarioDialogs', JSON.stringify(dialogs));
        if (currentDialogId) {
          localStorage.setItem('lastActiveDialog', currentDialogId);
        }
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤:', e);
      }
    }
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞
    function createNewDialog() {
      const timestamp = new Date().toISOString();
      const timeString = new Date().toLocaleTimeString('ru-RU', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });
      
      const newDialog = {
        id: 'dialog_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
        title: '–î–∏–∞–ª–æ–≥ ' + timeString,
        messages: [
          {
            id: 'msg_' + Date.now(),
            role: 'assistant',
            content: 'üëã –ü—Ä–∏–≤–µ—Ç! –Ø –†–æ–º–∞—Ä–∏–æ ‚Äî –≤–∞—à –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å, –∏ —è –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –ø–æ–º–æ—á—å.',
            timestamp: timestamp
          }
        ],
        createdAt: timestamp,
        updatedAt: timestamp,
        messageCount: 1
      };
      
      dialogs.unshift(newDialog);
      saveDialogs();
      renderDialogsList();
      loadDialog(newDialog.id);
      
      // –û—á–∏—â–∞–µ–º —á–∞—Ç –∏ –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
      const chatMessages = document.getElementById('chatMessages');
      chatMessages.innerHTML = '';
      
      addMessageToChat('üëã –ü—Ä–∏–≤–µ—Ç! –Ø –†–æ–º–∞—Ä–∏–æ ‚Äî –≤–∞—à –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å, –∏ —è –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –ø–æ–º–æ—á—å.', 
                      'assistant', timestamp, true);
      
      // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
      document.getElementById('messageInput').focus();
      
      console.log('–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥:', newDialog.id);
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∏–∞–ª–æ–≥–∞ –ø–æ ID
    function loadDialog(dialogId) {
      const dialog = dialogs.find(d => d.id === dialogId);
      if (!dialog) {
        console.error('–î–∏–∞–ª–æ–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω:', dialogId);
        createNewDialog();
        return;
      }
      
      currentDialogId = dialogId;
      saveDialogs();
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
      document.getElementById('currentDialogTitle').textContent = dialog.title;
      document.getElementById('currentDialogSubtitle').textContent = 
        `–°–æ–∑–¥–∞–Ω: ${new Date(dialog.createdAt).toLocaleDateString('ru-RU')} ‚Ä¢ –°–æ–æ–±—â–µ–Ω–∏–π: ${dialog.messages ? dialog.messages.length : 0}`;
      
      // –û—á–∏—â–∞–µ–º –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º —á–∞—Ç
      const chatMessages = document.getElementById('chatMessages');
      chatMessages.innerHTML = '';
      
      if (dialog.messages && dialog.messages.length > 0) {
        dialog.messages.forEach(msg => {
          addMessageToChat(msg.content, msg.role, msg.timestamp, false);
        });
      } else {
        // –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ
        addMessageToChat('üëã –ü—Ä–∏–≤–µ—Ç! –Ø –†–æ–º–∞—Ä–∏–æ ‚Äî –≤–∞—à –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å, –∏ —è –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –ø–æ–º–æ—á—å.', 
                        'assistant', new Date().toISOString(), false);
      }
      
      // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –¥–∏–∞–ª–æ–≥ –≤ —Å–ø–∏—Å–∫–µ
      renderDialogsList();
      
      console.log('–ó–∞–≥—Ä—É–∂–µ–Ω –¥–∏–∞–ª–æ–≥:', dialogId);
    }
    
    // –£–¥–∞–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞
    function deleteDialog(dialogId, event) {
      if (event) event.stopPropagation();
      
      if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–∏–∞–ª–æ–≥?')) return;
      
      const dialogIndex = dialogs.findIndex(d => d.id === dialogId);
      if (dialogIndex === -1) return;
      
      dialogs.splice(dialogIndex, 1);
      saveDialogs();
      
      if (currentDialogId === dialogId) {
        if (dialogs.length > 0) {
          loadDialog(dialogs[0].id);
        } else {
          createNewDialog();
        }
      }
      
      renderDialogsList();
      console.log('–£–¥–∞–ª–µ–Ω –¥–∏–∞–ª–æ–≥:', dialogId);
    }
    
    // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞
    function renameDialog(dialogId, event) {
      if (event) event.stopPropagation();
      
      const dialog = dialogs.find(d => d.id === dialogId);
      if (!dialog) return;
      
      const newTitle = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞:', dialog.title);
      if (newTitle && newTitle.trim()) {
        dialog.title = newTitle.trim();
        dialog.updatedAt = new Date().toISOString();
        saveDialogs();
        renderDialogsList();
        
        if (currentDialogId === dialogId) {
          document.getElementById('currentDialogTitle').textContent = dialog.title;
        }
      }
    }
    
    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤
    function renderDialogsList() {
      const dialogsList = document.getElementById('dialogsList');
      const emptyState = document.getElementById('emptyState');
      
      if (!dialogs || dialogs.length === 0) {
        if (emptyState) {
          emptyState.style.display = 'block';
        } else {
          dialogsList.innerHTML = `
            <div class="empty-state" id="emptyState" style="text-align: center; padding: 40px 20px; color: rgba(255,255,255,0.4)">
              <p>–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤</p>
              <p style="font-size: 0.9rem; margin-top: 10px;">–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ</p>
            </div>
          `;
        }
        return;
      }
      
      if (emptyState) emptyState.style.display = 'none';
      
      dialogsList.innerHTML = dialogs.map(dialog => {
        const lastMessage = dialog.messages && dialog.messages.length > 0 
          ? dialog.messages[dialog.messages.length - 1].content 
          : '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π';
        
        return `
          <div class="dialog-item ${currentDialogId === dialog.id ? 'active' : ''}" 
               onclick="loadDialog('${dialog.id}')">
            <div class="dialog-title">${escapeHtml(dialog.title)}</div>
            <div class="dialog-preview">${escapeHtml(lastMessage.length > 60 ? lastMessage.substring(0, 60) + '...' : lastMessage)}</div>
            <div class="dialog-meta">
              <span>${new Date(dialog.updatedAt).toLocaleDateString('ru-RU')}</span>
              <span>${dialog.messages ? dialog.messages.length : 0} —Å–æ–æ–±—â.</span>
            </div>
            <div class="dialog-actions">
              <button class="dialog-btn rename" onclick="renameDialog('${dialog.id}', event)">
                ‚úèÔ∏è
              </button>
              <button class="dialog-btn delete" onclick="deleteDialog('${dialog.id}', event)">
                üóëÔ∏è
              </button>
            </div>
          </div>
        `;
      }).join('');
    }
    
    // –û–¢–ü–†–ê–í–ö–ê –°–û–û–ë–©–ï–ù–ò–Ø - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
    async function sendMessage() {
      console.log('sendMessage –≤—ã–∑–≤–∞–Ω–∞');
      
      if (isStreaming) {
        console.log('–£–∂–µ –∏–¥–µ—Ç –ø–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞');
        return;
      }
      
      const input = document.getElementById('messageInput');
      const message = input.value.trim();
      
      if (!message) {
        console.log('–ü—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
        return;
      }
      
      console.log('–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:', message);
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–µ–∫—É—â–∏–π –¥–∏–∞–ª–æ–≥
      let dialog = dialogs.find(d => d.id === currentDialogId);
      if (!dialog) {
        console.log('–î–∏–∞–ª–æ–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π');
        createNewDialog();
        dialog = dialogs.find(d => d.id === currentDialogId);
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —á–∞—Ç
      const userTimestamp = new Date().toISOString();
      addMessageToChat(message, 'user', userTimestamp, true);
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –¥–∏–∞–ª–æ–≥
      if (dialog) {
        if (!dialog.messages) dialog.messages = [];
        
        dialog.messages.push({
          id: 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
          role: 'user',
          content: message,
          timestamp: userTimestamp
        });
        
        dialog.updatedAt = new Date().toISOString();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–∏–∞–ª–æ–≥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
        if (dialog.messages.length === 2) { // –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
          dialog.title = message.length > 30 ? message.substring(0, 30) + '...' : message;
        }
        
        saveDialogs();
        renderDialogsList();
      }
      
      // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
      input.value = '';
      
      // –ë–ª–æ–∫–∏—Ä—É–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
      isStreaming = true;
      const sendBtn = document.getElementById('sendBtn');
      sendBtn.disabled = true;
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞
      addTypingIndicator();
      
      try {
        console.log('–ù–∞—á–∏–Ω–∞–µ–º –∏–º–∏—Ç–∞—Ü–∏—é –æ—Ç–≤–µ—Ç–∞');
        // –ò–º–∏—Ç–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
        await simulateStreamingResponse(message, dialog);
        console.log('–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω —É—Å–ø–µ—à–Ω–æ');
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞:', error);
        addMessageToChat('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.', 
                        'assistant', new Date().toISOString(), true);
      } finally {
        // –£–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É
        removeTypingIndicator();
        isStreaming = false;
        sendBtn.disabled = false;
        input.focus();
        console.log('sendMessage –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
      }
    }
    
    // –ò–º–∏—Ç–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ - –†–ê–ë–û–ß–ê–Ø –í–ï–†–°–ò–Ø
    async function simulateStreamingResponse(userMessage, dialog) {
      console.log('simulateStreamingResponse –Ω–∞—á–∞—Ç–∞ –¥–ª—è:', userMessage.substring(0, 50) + '...');
      
      const assistantTimestamp = new Date().toISOString();
      
      // –°–æ–∑–¥–∞–µ–º –ø—É–∑—ã—Ä—å –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
      const chatMessages = document.getElementById('chatMessages');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message assistant';
      
      const timeString = new Date().toLocaleTimeString('ru-RU', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });
      
      messageDiv.innerHTML = `
        <div class="message-bubble" id="streamingBubble_${Date.now()}"></div>
        <div class="message-time">${timeString}</div>
      `;
      
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      const bubble = messageDiv.querySelector('.message-bubble');
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      let fullResponse = '';
      
      // –ü—Ä–æ—Å—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã
      const msg = userMessage.toLowerCase().trim();
      
      if (msg.includes('–ø—Ä–∏–≤–µ—Ç') || msg.includes('–∑–¥—Ä–∞–≤—Å—Ç–≤') || msg === 'hi' || msg === 'hello') {
        fullResponse = `–ü—Ä–∏–≤–µ—Ç! üëã –†–∞–¥ –≤–∞—Å –≤–∏–¥–µ—Ç—å! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å —Å–µ–≥–æ–¥–Ω—è?`;
      } else if (msg.includes('–∫–∞–∫ –¥–µ–ª–∞') || msg.includes('–∫–∞–∫ —Ç—ã')) {
        fullResponse = `–£ –º–µ–Ω—è –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ! üòä –Ø –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤ –ø–æ–º–æ–≥–∞—Ç—å. –ê –∫–∞–∫ –≤–∞—à–∏ –¥–µ–ª–∞? –ß–µ–º –º–æ–≥—É –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω?`;
      } else if (msg.includes('—Å–ø–∞—Å–∏–±–æ') || msg.includes('–±–ª–∞–≥–æ–¥–∞—Ä—é')) {
        fullResponse = `–í—Å–µ–≥–¥–∞ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞! üéØ –û–±—Ä–∞—â–∞–π—Ç–µ—Å—å, –µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –µ—â–µ –ø–æ–º–æ—â—å.`;
      } else if (msg.includes('–ø–æ–∫–∞') || msg.includes('–¥–æ —Å–≤–∏–¥–∞–Ω')) {
        fullResponse = `–î–æ —Å–≤–∏–¥–∞–Ω–∏—è! üëã –ë—É–¥—É —Ä–∞–¥ –ø–æ–º–æ—á—å –≤–∞–º —Å–Ω–æ–≤–∞ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è.`;
      } else {
        // –ë–∞–∑–æ–≤—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        const responses = [
          `–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! ü§î –Ø –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å: "${userMessage}".`,
          `–ú–æ–≥—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–¥–µ–π –ø–æ —ç—Ç–æ–π —Ç–µ–º–µ...`,
          `\n\n**–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:**\n1. –≠—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è\n2. –í–∞–∂–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã\n3. –ú–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ\n\n–ï—Å—Ç—å —á—Ç–æ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ, —á—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?`
        ];
        fullResponse = responses.join(' ');
      }
      
      // –ò–º–∏—Ç–∏—Ä—É–µ–º –ø–æ—Ç–æ–∫–æ–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É
      const words = fullResponse.split(' ');
      let currentText = '';
      
      for (let i = 0; i < words.length; i++) {
        await new Promise(resolve => setTimeout(resolve, 30 + Math.random() * 70));
        currentText += (i === 0 ? '' : ' ') + words[i];
        bubble.innerHTML = markdownToHtml(currentText);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –ø–∞—É–∑—É –≤ –∫–æ–Ω—Ü–µ
      await new Promise(resolve => setTimeout(resolve, 300));
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç –≤ –¥–∏–∞–ª–æ–≥
      if (dialog) {
        if (!dialog.messages) dialog.messages = [];
        
        dialog.messages.push({
          id: 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
          role: 'assistant',
          content: fullResponse,
          timestamp: assistantTimestamp
        });
        
        dialog.updatedAt = new Date().toISOString();
        dialog.messageCount = dialog.messages.length;
        saveDialogs();
        renderDialogsList();
      }
      
      console.log('simulateStreamingResponse –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
    }
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
    function addMessageToChat(content, role, timestamp = null, scroll = true) {
      const chatMessages = document.getElementById('chatMessages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${role}`;
      
      const time = timestamp ? new Date(timestamp) : new Date();
      const timeString = time.toLocaleTimeString('ru-RU', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });
      
      messageDiv.innerHTML = `
        <div class="message-bubble">${markdownToHtml(escapeHtml(content))}</div>
        <div class="message-time">${timeString}</div>
      `;
      
      chatMessages.appendChild(messageDiv);
      
      if (scroll) {
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
      
      return messageDiv;
    }
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –Ω–∞–±–æ—Ä–∞
    function addTypingIndicator() {
      const chatMessages = document.getElementById('chatMessages');
      const indicator = document.createElement('div');
      indicator.className = 'typing-indicator';
      indicator.id = 'typingIndicator';
      
      indicator.innerHTML = `
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      `;
      
      chatMessages.appendChild(indicator);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    // –£–¥–∞–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –Ω–∞–±–æ—Ä–∞
    function removeTypingIndicator() {
      const indicator = document.getElementById('typingIndicator');
      if (indicator) {
        indicator.remove();
      }
    }
    
    // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
    function escapeHtml(str) {
      if (!str) return '';
      return str
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
    }
    
    // –ü—Ä–æ—Å—Ç–æ–π Markdown –≤ HTML
    function markdownToHtml(md) {
      if (!md) return '';
      
      return md
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/`([^`]+)`/g, '<code>$1</code>')
        .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
        .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>')
        .replace(/\n/g, '<br>');
    }
  </script>
</body>
</html>